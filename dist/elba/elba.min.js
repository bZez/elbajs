/*! elba - v0.3.2 - 2015-01-30
* https://github.com/iliketomatoes/elbajs
* Copyright (c) 2015 ; Licensed  */
!function(a){"use strict";"function"==typeof define&&define.amd?define(a):window.Elba=a()}(function(){"use strict";function a(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function b(a,b){var c=r(a,b)?t:s;c(a,b)}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a){return"undefined"!=typeof a&&a?a.offsetWidth:window.innerWidth||document.documentElement.clientWidth}function e(a){return"undefined"!=typeof a&&a?a.offsetHeight:window.innerHeight||document.documentElement.clientHeight}function f(a,b){if(a&&b)for(var c=a.length,d=0;c>d&&b(a[d],d)!==!1;d++);}function g(a){return a?parseInt(a,10):0}function h(a,b){return g(-(d(a)*b))}function i(a,b){for(;a&&a.parentNode;)if(a=a.parentNode,a.className===b)return a;return null}function j(a,b){return u.has(a,b)}function k(a){"function"==typeof jQuery&&a instanceof jQuery&&(a=a[0]);var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)}function l(){for(var a="transform WebkitTransform MozTransform OTransform msTransform".split(" "),b=0;b<a.length;b++)if(void 0!==document.createElement("div").style[a[b]])return a[b];return!1}function m(a){return w.hasOwnProperty(a)?w[a]:w.easeInOutSine}function n(a,b){return o(a[0],a[1],a[2],a[3],b)}function o(a,b,c,d,e){var f=function(b){var d=1-b;return 3*d*d*b*a+3*d*b*b*c+b*b*b},g=function(a){var c=1-a;return 3*c*c*a*b+3*c*a*a*d+a*a*a},h=function(b){var d=1-b;return 3*(2*(b-1)*b+d*d)*a+3*(-b*b*b+2*d*b)*c};return function(a){var b,c,d,i,j,k,l=a;for(d=l,k=0;8>k;k++){if(i=f(d)-l,Math.abs(i)<e)return g(d);if(j=h(d),Math.abs(j)<1e-6)break;d-=i/j}if(b=0,c=1,d=l,b>d)return g(b);if(d>c)return g(c);for(;c>b;){if(i=f(d),Math.abs(i-l)<e)return g(d);l>i?b=d:c=d,d=.5*(c-b)+b}return g(d)}}function p(a,b,e){var f=a,g={selector:".elba",separator:"|",breakpoints:!1,successClass:"elba-loaded",errorClass:"elba-error",container:"elba-wrapper",src:"data-src",error:!1,success:!1,duration:1e3,easing:"easeInOutCubic",navigation:!0,dots:!0,dotsContainer:!1,slideshow:5e3,preload:1,textLeft:"←",textRight:"→"};if("undefined"==typeof b)throw new Error;f.base={el:b,container:null,containerWidth:0,slides:[],wrapper:null,count:0,source:0,navigation:{left:null,right:null,dots:null},pointer:0,directionHint:"right",resizeTimeout:null,animated:!1},f.options=c(g,e),C.createSlideArray(f.base,f.options),C.setupWrapper(f.base),C.cloneHeadAndTail(f.base),f.base.container=i(f.base.el,f.options.container),f.base.containerWidth=d(f.base.container),f.base.count>1&&(A.offset(f.base.el,-f.base.containerWidth),f.options.navigation&&(C.setupNavigation(f.base,f.options,"left"),C.setupNavigation(f.base,f.options,"right")),f.options.dots&&(C.setupDots(f.base,f.options.dotsContainer),u.add(f.base.navigation.dots[f.base.pointer],"active-dot"))),f.bindEvents(),f.loadImages()}function q(a,b){p(this,a,b)}var r,s,t;"classList"in document.documentElement?(r=function(a,b){return a.classList.contains(b)},s=function(a,b){a.classList.add(b)},t=function(a,b){a.classList.remove(b)}):(r=function(b,c){return a(c).test(b.className)},s=function(a,b){r(a,b)||(a.className=a.className+" "+b)},t=function(b,c){b.className=b.className.replace(a(c)," ")});var u={hasClass:r,addClass:s,removeClass:t,toggleClass:b,has:r,add:s,remove:t,toggle:b};HTMLElement.prototype.wrap=function(a){a.length||(a=[a]);for(var b=a.length-1;b>=0;b--){var c=b>0?this.cloneNode(!0):this,d=a[b],e=d.parentNode,f=d.nextSibling;c.appendChild(d),f?e.insertBefore(c,f):e.appendChild(c)}},Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=window.HTMLCollection.prototype.remove=function(){for(var a=0,b=this.length;b>a;a++)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};var v=l(),w={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]},x=0;window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-x)),d=window.setTimeout(function(){a(b+c)},c);return x=b+c,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var y=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame,z=window.mozCancelAnimationFrame||window.cancelAnimationFrame,A={easeing:"easeInOutSine",animated:!1,dragged:null,getAnimationCurve:function(a,b){var c=1e3/60/a/4;return n(b,c)},actualAnimation:function(a,b,c,d,e){function f(b){null===m&&(m=b);var n=b-m,o=n/c;o>=1&&(o=1);var p=d(o).toFixed(2);i.step(j,p,e,k),1===o?(z(g),m=null,l>1&&(a.pointer===l-1?(a.pointer=1,i.offset(j,h(a.container,a.pointer))):0===a.pointer&&(a.pointer=l-2,i.offset(j,h(a.container,a.pointer)))),a.animated=!1):y(f)}var g,i=this,j=a.el,k=e-b,l=a.slides.length,m=null;g=y(f)},step:function(a,b,c,d){this.offset(a,parseInt(c)+parseInt((d-c)*b))},offset:function(a,b){if("undefined"==typeof b){if(v){var c=a.style[v]?a.style[v].match(/-?\d+/g)[0]:0;return c}return a.style.left}v?a.style[v]="translate("+b+"px, 0px)":a.style.left=b+"px"},animate:function(a,b,c,d){var e=this,f=d||e.easeing,g=m(f);if(a.animated)return!1;a.animated=!0;var h=e.getAnimationCurve(c,g);e.actualAnimation(a,b,c,h,e.offset(a.el))},drag:function(a,b){var c=this;return c.animated?!1:void a.forEach(function(a){c.dragged=y(function(){c.offset(a,b)})})},stopDragging:function(){var a=this;z(a.dragged)}},B={setSlidesWidth:function(a){var b=d(a.container),c=0;a.slides.forEach(function(a){c+=b,a.style.width=b+"px"}),a.el.style.width=c+"px"},setSource:function(a,b){a.source=0;var c=0,e=d(a.container);f(b.breakpoints,function(b){return b.width<=e&&Math.abs(e-b.width)<Math.abs(e-c)?(c=b.width,a.source=b.src,!0):void 0})},setImageSize:function(a,b){var c,f,g=b.naturalHeight/b.naturalWidth,h=d(a.container),i=e(a.container),j=i/h;j>=g?(b.height=c=Math.ceil(i),b.width=f=Math.ceil(i/g)):(b.height=c=Math.ceil(h*g),b.width=f=Math.ceil(h));var k=(h-f)/2,l=(i-c)/2;b.style.left=Math.ceil(k)+"px",b.style.top=Math.ceil(l)+"px"},lazyLoadImages:function(a,b,c){var d=this,e=c||a.pointer,f=a.slides[e];if(!f)return!1;(j(f,b.successClass)||j(f,b.errorClass))&&d.loadNext(a,b,e);var g=f.getAttribute(a.source||b.src),h=f.querySelector(".elba-island");if(g){var i=g.split(b.separator),k=i[E&&i.length>1?1:0],l=new Image;l.onerror=function(){b.error&&b.error(f,"invalid"),f.className=f.className+" "+b.errorClass},l.onload=function(){if(h.src=k,d.setImageSize(a,h),u.add(f,"no-bg-img"),u.add(f,b.successClass),b.success&&b.success(f),a.count>1&&(1===e||0===e||e===a.count-1||e===a.count-2)){var c,g;c=1===e?a.slides[a.count-1]:e===a.count-1?a.slides[1]:0===e?a.slides[a.count-2]:a.slides[0],j(c,b.successClass)||(g=c.querySelector(".elba-island"),g.src=k,d.setImageSize(a,g),u.add(c,"no-bg-img"),u.add(c,b.successClass))}d.loadNext(a,b,e)},l.src=k}else d.loadNext(a,b,e),b.error&&b.error(f,"missing"),f.className=f.className+" "+b.errorClass},loadNext:function(a,b,c){var d=this;if("right"===a.directionHint)a.count>1&&c+1<a.count-1&&Math.abs(c+1-a.pointer)<=b.preload&&(c++,d.lazyLoadImages(a,b,c));else{if(!(a.count>1&&c-1>0&&Math.abs(c-1-a.pointer)<=b.preload))return!1;c--,d.lazyLoadImages(a,b,c)}}},C={createSlideArray:function(a,b){var c=a.el.querySelectorAll(b.selector);a.count=c.length;for(var d=a.count;d--;a.slides.unshift(c[d]));},setupWrapper:function(a){a.wrapper=document.createElement("div"),a.wrapper.className="elba-wrapper",a.wrapper.wrap(a.el)},cloneHeadAndTail:function(a){if(a.count>1){a.pointer=1;var b=a.slides[a.count-1].cloneNode(!0);a.el.insertBefore(b,a.el.firstChild),a.slides.unshift(b);var c=a.slides[1].cloneNode(!0);a.el.appendChild(c),a.slides.push(c),a.count+=2}a.slides.forEach(function(a){var b=document.createElement("img");b.className="elba-island",a.appendChild(b)})},setupNavigation:function(a,b,c){var d;a.navigation[c]=document.createElement("a"),a.navigation[c].className="elba-"+c+"-nav","left"===c?(d=document.createTextNode(b.textLeft),a.navigation[c].appendChild(d)):(d=document.createTextNode(b.textRight),a.navigation[c].appendChild(d)),a.wrapper.appendChild(a.navigation[c])},setupDots:function(a,b){a.navigation.dots=[];var c;b?c=document.getElementById(b):(c=document.createElement("div"),c.className="elba-dots-ctr",a.wrapper.appendChild(c));for(var d=1;d<a.count-1;d++)a.navigation.dots[d]=document.createElement("a"),a.navigation.dots[d].className="elba-dot",c.appendChild(a.navigation.dots[d])}},D={updateDots:function(a){a.navigation.dots.forEach(function(a){a&&u.remove(a,"active-dot")});var b;b=a.pointer===a.slides.length-1?1:0===a.pointer?a.slides.length-2:a.pointer,a.navigation.dots[b]&&u.add(a.navigation.dots[b],"active-dot")},destroy:function(a,b){for(var c=a.slides.length,d=0;c>d;d++){var e=a.slides[d];e&&(u.remove(e,"no-bg-img"),u.remove(e,b.successClass))}},doResize:function(a,b){var c=this;B.setSlidesWidth(a),left(a.el,h(a.container,a.pointer));var d=a.source;if(B.setSource(a,b),d!==a.source)c.destroy(a,b),B.lazyLoadImages(a,b);else for(var e=0;e<a.slides.length;e++){var f=a.slides[e];if(f){var g=f.querySelector(".elba-island");B.setImageSize(a,g)}}},resizeHandler:function(a,b){function c(){d.doResize(a,b),a.resizeTimeout=null}var d=this;a.resizeTimeout&&clearTimeout(a.resizeTimeout),a.resizeTimeout=setTimeout(c,200)}},E=window.devicePixelRatio>1;return q.prototype.loadImages=function(){var a=this;B.setSlidesWidth(a.base),B.setSource(a.base,a.options),B.lazyLoadImages(a.base,a.options)},q.prototype.bindEvents=function(){var a=this;if(a.options.navigation&&(a.base.navigation.left.addEventListener("click",function(b){b.preventDefault(),a.goTo("left"),a.options.slideshow&&a.startSlideshow()},!1),a.base.navigation.right.addEventListener("click",function(b){b.preventDefault(),a.goTo("right"),a.options.slideshow&&a.startSlideshow()},!1)),a.options.dots)for(var b=function(b){return function(){var c=a.base.navigation.dots[b].getAttribute("data-target");return parseInt(c)===a.base.pointer?!1:(a.goTo(c),a.options.slideshow&&a.startSlideshow(),!1)}},c=1;c<a.base.slides.length-1;c++)a.base.navigation.dots[c].setAttribute("data-target",c),a.base.navigation.dots[c].addEventListener("click",b(c),!1)},q.prototype.goTo=function(a){var b=this;if(!b.base.animated){if("string"==typeof a&&isNaN(a)){var c=b.base.slides.length;if("right"===a){if(b.base.pointer+1>=c)return!1;b.base.directionHint="right",b.base.pointer++,B.lazyLoadImages(b.base,b.options),A.animate(b.base,b.base.containerWidth,b.options.duration,b.options.easing)}else{if(b.base.pointer-1<0)return!1;b.base.directionHint="left",b.base.pointer--,B.lazyLoadImages(b.base,b.options),A.animate(b.base,-b.base.containerWidth,b.options.duration,b.options.easing)}}else if(!isNaN(a)){var d=b.base.pointer;b.base.pointer=parseInt(a),b.base.pointer>d?(b.base.directionHint="right",B.lazyLoadImages(b.base,b.options),A.animate(b.base,b.base.containerWidth,b.options.duration,b.options.easing)):(b.base.directionHint="left",B.lazyLoadImages(b.base,b.options),A.animate(b.base,-b.base.containerWidth,b.options.duration,b.options.easing))}b.options.dots&&D.updateDots(b.base)}},q.prototype.startSlideshow=function(){var a=this;a.base.slides.length>1&&(a.slideshow&&clearInterval(a.slideshow),a.slideshow=setInterval(function(){if(!k(a.base.container))return!1;var b=a.base.slides[a.base.pointer+1];b&&(u.has(b,a.options.successClass)||u.has(b,a.options.errorClass))&&a.goTo("right")},a.options.slideshow))},q.prototype.clearSlideshow=function(){var a=this;a.slideshow&&clearInterval(a.slideshow)},q.prototype.stopSlideshow=function(){var a=this;a.slideshow&&clearInterval(a.slideshow),a.options.slideshow=0},q.prototype.getCurrent=function(){return this.base.pointer},q});