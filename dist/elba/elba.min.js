/*! elba - v0.3.2 - 2015-02-03
* https://github.com/iliketomatoes/elbajs
* Copyright (c) 2015 ; Licensed  */
!function(a){"use strict";"function"==typeof define&&define.amd?define(a):window.Elba=a()}(function(){"use strict";function a(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function b(a,b){var c=s(a,b)?u:t;c(a,b)}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a){return"undefined"!=typeof a&&a?a.offsetWidth:window.innerWidth||document.documentElement.clientWidth}function e(a){return"undefined"!=typeof a&&a?a.offsetHeight:window.innerHeight||document.documentElement.clientHeight}function f(a,b){if(a&&b)for(var c=a.length,d=0;c>d&&b(a[d],d)!==!1;d++);}function g(a){return a?parseInt(a,10):0}function h(a,b){return g(-(d(a)*b))}function i(a,b){for(;a&&a.parentNode;)if(a=a.parentNode,a.className===b)return a;return null}function j(a,b){return v.has(a,b)}function k(a){"function"==typeof jQuery&&a instanceof jQuery&&(a=a[0]);var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)}function l(a,b,c){for(var d=b.split(" "),e=d.length;e--;)a.addEventListener(d[e],c,!1)}function m(){for(var a="transform WebkitTransform MozTransform OTransform msTransform".split(" "),b=0;b<a.length;b++)if(void 0!==document.createElement("div").style[a[b]])return a[b];return!1}function n(a,b,c,d,e){a.pointer=d,a.directionHint=c,E.lazyLoadImages(a,b),D.animate(a,e,b.duration,b.easing),b.dots&&G.updateDots(a)}function o(a){return x.hasOwnProperty(a)?x[a]:x.easeInOutSine}function p(a,b){return q(a[0],a[1],a[2],a[3],b)}function q(a,b,c,d,e){var f=function(b){var d=1-b;return 3*d*d*b*a+3*d*b*b*c+b*b*b},g=function(a){var c=1-a;return 3*c*c*a*b+3*c*a*a*d+a*a*a},h=function(b){var d=1-b;return 3*(2*(b-1)*b+d*d)*a+3*(-b*b*b+2*d*b)*c};return function(a){var b,c,d,i,j,k,l=a;for(d=l,k=0;8>k;k++){if(i=f(d)-l,Math.abs(i)<e)return g(d);if(j=h(d),Math.abs(j)<1e-6)break;d-=i/j}if(b=0,c=1,d=l,b>d)return g(b);if(d>c)return g(c);for(;c>b;){if(i=f(d),Math.abs(i-l)<e)return g(d);l>i?b=d:c=d,d=.5*(c-b)+b}return g(d)}}function r(a,b){var e=this,f={selector:".elba",separator:"|",breakpoints:!1,successClass:"elba-loaded",errorClass:"elba-error",container:"elba-wrapper",src:"data-src",error:!1,success:!1,duration:1e3,easing:"easeInOutCubic",navigation:!0,dots:!0,dotsContainer:!1,slideshow:5e3,preload:1,swipeTreshold:60,reboundSpeed:600,textLeft:"←",textRight:"→"};if("undefined"==typeof a)throw new Error;e.base={el:a,container:null,containerWidth:0,slides:[],wrapper:null,count:0,source:0,navigation:{left:null,right:null,dots:null},pointer:0,directionHint:"right",resizeTimeout:null,animated:!1},e.options=c(f,b),F.createSlideArray(e.base,e.options),F.setupWrapper(e.base),F.cloneHeadAndTail(e.base),e.base.container=i(e.base.el,e.options.container),e.base.containerWidth=d(e.base.container),e.base.count>1&&(D.offset(e.base.el,-e.base.containerWidth),e.options.navigation&&(F.setupNavigation(e.base,e.options,"left"),F.setupNavigation(e.base,e.options,"right")),e.options.dots&&(F.setupDots(e.base,e.options.dotsContainer),v.add(e.base.navigation.dots[e.base.pointer],"active-dot"))),e.bindEvents(),e.loadImages()}var s,t,u;"classList"in document.documentElement?(s=function(a,b){return a.classList.contains(b)},t=function(a,b){a.classList.add(b)},u=function(a,b){a.classList.remove(b)}):(s=function(b,c){return a(c).test(b.className)},t=function(a,b){s(a,b)||(a.className=a.className+" "+b)},u=function(b,c){b.className=b.className.replace(a(c)," ")});var v={hasClass:s,addClass:t,removeClass:u,toggleClass:b,has:s,add:t,remove:u,toggle:b};HTMLElement.prototype.wrap=function(a){a.length||(a=[a]);for(var b=a.length-1;b>=0;b--){var c=b>0?this.cloneNode(!0):this,d=a[b],e=d.parentNode,f=d.nextSibling;c.appendChild(d),f?e.insertBefore(c,f):e.appendChild(c)}},Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=window.HTMLCollection.prototype.remove=function(){for(var a=0,b=this.length;b>a;a++)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};var w=m(),x={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]},y=0;window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-y)),d=window.setTimeout(function(){a(b+c)},c);return y=b+c,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var z,A,B=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame,C=window.mozCancelAnimationFrame||window.cancelAnimationFrame,D={easeing:"easeOutCubic",animated:!1,dragged:null,getAnimationCurve:function(a,b){var c=1e3/60/a/4;return p(b,c)},actualAnimation:function(a,b,c,d,e){function f(b){null===m&&(m=b);var n=b-m,o=n/c;o>=1&&(o=1);var p=d(o).toFixed(2);i.step(j,p,e,k),1===o?(C(g),m=null,l>1&&(a.pointer===l-1?(a.pointer=1,i.offset(j,h(a.container,a.pointer))):0===a.pointer&&(a.pointer=l-2,i.offset(j,h(a.container,a.pointer)))),a.animated=!1):B(f)}var g,i=this,j=a.el,k=e-b,l=a.slides.length,m=null;g=B(f)},step:function(a,b,c,d){this.offset(a,parseInt(c)+parseInt((d-c)*b))},offset:function(a,b){if("undefined"==typeof b){if(w){var c=a.style[w]?a.style[w].match(/-?\d+/g)[0]:0;return c}return a.style.left}w?a.style[w]="translate("+b+"px, 0px)":a.style.left=b+"px"},animate:function(a,b,c,d){var e=this,f=d||e.easeing,g=o(f);if(a.animated)return!1;a.animated=!0;var h=e.getAnimationCurve(c,g);e.actualAnimation(a,b,c,h,e.offset(a.el))},drag:function(a,b){var c=this;return c.animated?!1:void(c.dragged=B(function(){c.offset(a,b)}))},stopDragging:function(){var a=this;C(a.dragged)}},E={setSlidesWidth:function(a){var b=d(a.container),c=0;a.slides.forEach(function(a){c+=b,a.style.width=b+"px"}),a.el.style.width=c+"px"},setSource:function(a,b){a.source=0;var c=0,e=d(a.container);f(b.breakpoints,function(b){return b.width<=e&&Math.abs(e-b.width)<Math.abs(e-c)?(c=b.width,a.source=b.src,!0):void 0})},setImageSize:function(a,b){var c,f,g=b.naturalHeight/b.naturalWidth,h=d(a.container),i=e(a.container),j=i/h;j>=g?(b.height=c=Math.ceil(i),b.width=f=Math.ceil(i/g)):(b.height=c=Math.ceil(h*g),b.width=f=Math.ceil(h));var k=(h-f)/2,l=(i-c)/2;b.style.left=Math.ceil(k)+"px",b.style.top=Math.ceil(l)+"px"},lazyLoadImages:function(a,b,c){var d=this,e=c||a.pointer,f=a.slides[e];if(!f)return!1;(j(f,b.successClass)||j(f,b.errorClass))&&d.loadNext(a,b,e);var g=f.getAttribute(a.source||b.src),h=f.querySelector(".elba-island");if(g){var i=g.split(b.separator),k=i[L&&i.length>1?1:0],l=new Image;l.onerror=function(){b.error&&b.error(f,"invalid"),f.className=f.className+" "+b.errorClass},l.onload=function(){if(h.src=k,d.setImageSize(a,h),v.add(f,"no-bg-img"),v.add(f,b.successClass),b.success&&b.success(f),a.count>1&&(1===e||0===e||e===a.count-1||e===a.count-2)){var c,g;c=1===e?a.slides[a.count-1]:e===a.count-1?a.slides[1]:0===e?a.slides[a.count-2]:a.slides[0],j(c,b.successClass)||(g=c.querySelector(".elba-island"),g.src=k,d.setImageSize(a,g),v.add(c,"no-bg-img"),v.add(c,b.successClass))}d.loadNext(a,b,e)},l.src=k}else d.loadNext(a,b,e),b.error&&b.error(f,"missing"),f.className=f.className+" "+b.errorClass},loadNext:function(a,b,c){var d=this;if("right"===a.directionHint)a.count>1&&c+1<a.count-1&&Math.abs(c+1-a.pointer)<=b.preload&&(c++,d.lazyLoadImages(a,b,c));else{if(!(a.count>1&&c-1>0&&Math.abs(c-1-a.pointer)<=b.preload))return!1;c--,d.lazyLoadImages(a,b,c)}}},F={createSlideArray:function(a,b){var c=a.el.querySelectorAll(b.selector);a.count=c.length;for(var d=a.count;d--;a.slides.unshift(c[d]));},setupWrapper:function(a){a.wrapper=document.createElement("div"),a.wrapper.className="elba-wrapper",a.wrapper.wrap(a.el)},cloneHeadAndTail:function(a){if(a.count>1){a.pointer=1;var b=a.slides[a.count-1].cloneNode(!0);a.el.insertBefore(b,a.el.firstChild),a.slides.unshift(b);var c=a.slides[1].cloneNode(!0);a.el.appendChild(c),a.slides.push(c),a.count+=2}a.slides.forEach(function(a){var b=document.createElement("img");b.className="elba-island",a.appendChild(b)})},setupNavigation:function(a,b,c){var d;a.navigation[c]=document.createElement("a"),a.navigation[c].className="elba-"+c+"-nav","left"===c?(d=document.createTextNode(b.textLeft),a.navigation[c].appendChild(d)):(d=document.createTextNode(b.textRight),a.navigation[c].appendChild(d)),a.wrapper.appendChild(a.navigation[c])},setupDots:function(a,b){a.navigation.dots=[];var c;b?c=document.getElementById(b):(c=document.createElement("div"),c.className="elba-dots-ctr",a.wrapper.appendChild(c));for(var d=1;d<a.count-1;d++)a.navigation.dots[d]=document.createElement("a"),a.navigation.dots[d].className="elba-dot",c.appendChild(a.navigation.dots[d])}},G={updateDots:function(a){a.navigation.dots.forEach(function(a){a&&v.remove(a,"active-dot")});var b;b=a.pointer===a.slides.length-1?1:0===a.pointer?a.slides.length-2:a.pointer,a.navigation.dots[b]&&v.add(a.navigation.dots[b],"active-dot")},destroy:function(a,b){for(var c=a.slides.length,d=0;c>d;d++){var e=a.slides[d];e&&(v.remove(e,"no-bg-img"),v.remove(e,b.successClass))}},doResize:function(a,b){var c=this;a.containerWidth=d(a.container),E.setSlidesWidth(a),console.log(h(a.container,a.pointer)),D.offset(a.el,h(a.container,a.pointer));var e=a.source;if(E.setSource(a,b),e!==a.source)c.destroy(a,b),E.lazyLoadImages(a,b);else for(var f=0;f<a.slides.length;f++){var g=a.slides[f];if(g){var i=g.querySelector(".elba-island");E.setImageSize(a,i)}}},resizeHandler:function(a,b){function c(){d.doResize(a,b),a.resizeTimeout=null}var d=this;a.resizeTimeout&&clearTimeout(a.resizeTimeout),a.resizeTimeout=setTimeout(c,200)}},H=(!!navigator.pointerEnabled||navigator.msPointerEnabled,function(a){var b=a.toLowerCase(),c="MS"+a;return navigator.msPointerEnabled?c:b}),I={start:H("PointerDown")+" touchstart mousedown",end:H("PointerUp")+" touchend mouseup",move:H("PointerMove")+" touchmove mousemove"},J=function(a){return a.targetTouches?a.targetTouches[0]:a},K={points:{cachedX:null,cachedY:null,currX:null,currY:null},touchStarted:!1,touchEvents:I,getPointerEvent:J,onTouchStart:function(a){var b=this;if(b.touchStarted===!0)return!1;var c=b.getPointerEvent(a);return b.points.cachedX=b.points.currX=c.pageX,b.points.cachedY=b.points.currY=c.pageY,b.touchStarted=!0,b.points},onTouchEnd:function(){var a=this;if(a.touchStarted===!1)return!1;var b=a.points.cachedY-a.points.currY,c=a.points.cachedX-a.points.currX;return a.touchStarted=!1,{deltaX:c,deltaY:b}},onTouchMove:function(a){var b=this;if(b.touchStarted===!1)return!1;var c=b.getPointerEvent(a);return b.points.currX=c.pageX,b.points.currY=c.pageY,Math.abs(b.points.cachedY-b.points.currY)>=Math.abs(b.points.cachedX-b.points.currX)?!1:b.points}},L=window.devicePixelRatio>1;return"undefined"!=typeof document.hidden?(z="hidden",A="visibilitychange"):"undefined"!=typeof document.mozHidden?(z="mozHidden",A="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(z=" msHidden",A="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(z="webkitHidden",A="webkitvisibilitychange"),r.prototype.loadImages=function(){var a=this;E.setSource(a.base,a.options),E.setSlidesWidth(a.base),E.lazyLoadImages(a.base,a.options)},r.prototype.bindEvents=function(){var a,b,c,d,e,f,g=this;if(l(g.base.el,K.touchEvents.start,function(a){b=parseInt(D.offset(g.base.el)),c=K.onTouchStart(a),e=parseInt(g.base.containerWidth),d=g.base.pointer}),l(g.base.el,K.touchEvents.move,function(d){a=K.onTouchMove(d),a&&(f=a.currX-c.cachedX,D.drag(g.base.el,f+b),c=a)}),l(g.base.el,K.touchEvents.end,function(){K.onTouchEnd(),D.stopDragging(),Math.abs(f)>g.options.swipeTreshold&&(f>0?n(g.base,g.options,"left",g.base.pointer-1,-(g.base.containerWidth-Math.abs(f))):n(g.base,g.options,"right",g.base.pointer+1,g.base.containerWidth-Math.abs(f))),f=0,b=0}),g.options.navigation&&(g.base.navigation.left.addEventListener("click",function(a){a.preventDefault(),g.goTo("left"),g.options.slideshow&&g.startSlideshow()},!1),g.base.navigation.right.addEventListener("click",function(a){a.preventDefault(),g.goTo("right"),g.options.slideshow&&g.startSlideshow()},!1)),g.options.dots)for(var h=function(a){return function(){var b=parseInt(g.base.navigation.dots[a].getAttribute("data-target"));return parseInt(b)===g.base.pointer?!1:(g.goTo(b),g.options.slideshow&&g.startSlideshow(),!1)}},i=1;i<g.base.slides.length-1;i++)g.base.navigation.dots[i].setAttribute("data-target",i),g.base.navigation.dots[i].addEventListener("click",h(i),!1);if(g.options.slideshow){if("undefined"!=typeof document[z]){var j=function(){document[z]?g.clearSlideshow():g.startSlideshow()};document.addEventListener(A,j,!1)}g.startSlideshow()}window.addEventListener("resize",function(){G.resizeHandler(g.base,g.options)},!1)},r.prototype.goTo=function(a){var b=this;if(!b.base.animated)if("string"==typeof a&&isNaN(a)){var c=b.base.slides.length;if("right"===a){if(b.base.pointer+1>=c)return!1;n(b.base,b.options,"right",b.base.pointer+1,b.base.containerWidth)}else{if(b.base.pointer-1<0)return!1;n(b.base,b.options,"left",b.base.pointer-1,-b.base.containerWidth)}}else if("number"==typeof a){var d=b.base.pointer;b.base.pointer>d?n(b.base,b.options,"right",a,parseInt(b.base.containerWidth*(a-d))):n(b.base,b.options,"left",a,-parseInt(b.base.containerWidth*(d-a)))}},r.prototype.startSlideshow=function(){var a=this;a.base.slides.length>1&&(a.slideshow&&clearInterval(a.slideshow),a.slideshow=setInterval(function(){if(!k(a.base.container))return!1;var b=a.base.slides[a.base.pointer+1];b&&(v.has(b,a.options.successClass)||v.has(b,a.options.errorClass))&&a.goTo("right")},a.options.slideshow))},r.prototype.clearSlideshow=function(){var a=this;a.slideshow&&clearInterval(a.slideshow)},r.prototype.stopSlideshow=function(){var a=this;a.slideshow&&clearInterval(a.slideshow),a.options.slideshow=0},r.prototype.getCurrent=function(){return this.base.pointer},r});